================================================================================
æ™ºèƒ½é£Ÿç‰©è®°å½• - å‰ç«¯ä»£ç æ±‡æ€»
================================================================================

æœ¬æ–‡æ¡£åŒ…å«åŸºäº PRD å¼€å‘çš„æ‰€æœ‰å‰ç«¯ä»£ç ï¼Œç”¨äºå®¡æ ¸ã€‚

æŠ€æœ¯æ ˆï¼šVue 3 + TypeScript + Vite + Vue Router

================================================================================
é¡¹ç›®ç»“æ„
================================================================================

frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ index.ts          # API æœåŠ¡å±‚ï¼ˆå¯¹æ¥åç«¯ï¼‰
â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â”œâ”€â”€ Home.vue          # é¦–é¡µï¼ˆä»Šæ—¥ä½™é¢ã€æ™ºèƒ½å»ºè®®ã€ç«‹åˆ»è®°å½•ï¼‰
â”‚   â”‚   â”œâ”€â”€ Record.vue        # æ‹ç…§è®°å½•é¡µï¼ˆç›¸æœºã€AIè¯†åˆ«ã€ä»½é‡é€‰æ‹©ï¼‰
â”‚   â”‚   â”œâ”€â”€ Progress.vue      # è¿›åº¦è¿½è¸ªé¡µï¼ˆè¶‹åŠ¿å›¾ã€ç»Ÿè®¡æ•°æ®ï¼‰
â”‚   â”‚   â””â”€â”€ Goal.vue          # ç›®æ ‡è®¾ç½®é¡µï¼ˆèº«ä½“æ•°æ®ã€ç¼ºå£é€‰æ‹©ï¼‰
â”‚   â”œâ”€â”€ router/
â”‚   â”‚   â””â”€â”€ index.ts          # è·¯ç”±é…ç½®
â”‚   â”œâ”€â”€ App.vue               # æ ¹ç»„ä»¶
â”‚   â””â”€â”€ main.ts               # å…¥å£æ–‡ä»¶

================================================================================
æ–‡ä»¶ï¼šsrc/api/index.ts
================================================================================

/**
 * API æœåŠ¡å±‚ - å¯¹æ¥åç«¯
 */

const API_BASE_URL = 'http://localhost:8000/api'

// è¯·æ±‚å“åº”ç±»å‹
export interface PortionOption {
  id: number
  food_name: string
  portion_name: string
  weight_grams: number
  calories: number
  protein: number
}

export interface AnalyzeImageResponse {
  food_name: string
  portion_options: PortionOption[]
}

export interface MealRecordResponse {
  id: number
  image_url: string
  food_name: string
  visual_portion_id: number
  calories: number
  protein: number
  record_date: string
}

export interface DailyBalanceResponse {
  remaining_calories: number
  remaining_protein: number
  consumed_calories: number
  consumed_protein: number
  target_calories: number
  target_protein: number
  meals_count: number
}

export interface ProgressDataPoint {
  date: string
  calorie_deficit: number
  consumed_calories: number
}

export interface ProgressResponse {
  total_calorie_deficit: number
  estimated_fat_lost: number
  days_tracked: number
  data_points: ProgressDataPoint[]
  encouragement: string
}

export interface GoalResponse {
  id: number
  gender: string
  age: number
  height_cm: number
  weight_kg: number
  deficit_target: number
  calorie_target: number
  protein_target: number
}

// API æœåŠ¡
export const api = {
  /**
   * åˆ†æé£Ÿç‰©å›¾ç‰‡
   */
  async analyzeImage(imageBase64: string): Promise<AnalyzeImageResponse> {
    const response = await fetch(`${API_BASE_URL}/analyze`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ image_base64: imageBase64 })
    })
    if (!response.ok) throw new Error('å›¾ç‰‡è¯†åˆ«å¤±è´¥')
    return response.json()
  },

  /**
   * åˆ›å»ºé¥®é£Ÿè®°å½•
   */
  async createRecord(data: {
    image_url: string
    food_name: string
    visual_portion_id: number
  }): Promise<MealRecordResponse> {
    const response = await fetch(`${API_BASE_URL}/records`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    })
    if (!response.ok) throw new Error('åˆ›å»ºè®°å½•å¤±è´¥')
    return response.json()
  },

  /**
   * è·å–ä»Šæ—¥ä½™é¢
   */
  async getBalance(): Promise<DailyBalanceResponse> {
    const response = await fetch(`${API_BASE_URL}/balance`)
    if (!response.ok) throw new Error('è·å–ä½™é¢å¤±è´¥')
    return response.json()
  },

  /**
   * è·å–è¿›åº¦ç»Ÿè®¡
   */
  async getProgress(range: 'week' | 'month' | 'all' = 'all'): Promise<ProgressResponse> {
    const response = await fetch(`${API_BASE_URL}/progress?range=${range}`)
    if (!response.ok) throw new Error('è·å–è¿›åº¦å¤±è´¥')
    return response.json()
  },

  /**
   * è®¾ç½®ç›®æ ‡
   */
  async setGoal(data: {
    gender: string
    age: number
    height_cm: number
    weight_kg: number
    deficit_target: number
  }): Promise<GoalResponse> {
    const response = await fetch(`${API_BASE_URL}/goals`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    })
    if (!response.ok) throw new Error('è®¾ç½®ç›®æ ‡å¤±è´¥')
    return response.json()
  },

  /**
   * è·å–å½“å‰ç›®æ ‡
   */
  async getGoal(): Promise<GoalResponse | null> {
    const response = await fetch(`${API_BASE_URL}/goals`)
    if (!response.ok) return null
    const data = await response.json()
    return data || null
  }
}

================================================================================
æ–‡ä»¶ï¼šsrc/views/Home.vueï¼ˆé¦–é¡µï¼‰
================================================================================

é¡µé¢åŠŸèƒ½ï¼š
- æ˜¾ç¤ºä»Šæ—¥ä½™é¢ï¼ˆå‰©ä½™çƒ­é‡ã€å‰©ä½™è›‹ç™½è´¨ï¼‰
- æ™ºèƒ½å»ºè®®ï¼ˆæ ¹æ®å‰©ä½™é¢åº¦æ¨èé£Ÿç‰©ï¼‰
- ç«‹åˆ»è®°å½•æŒ‰é’®ï¼ˆè·³è½¬åˆ°æ‹ç…§é¡µï¼‰
- ä»Šæ—¥è®°å½•çŠ¶æ€ï¼ˆâœ”æ•°é‡è¡¨ç¤ºå·²è®°å½•é¤æ•°ï¼‰
- æŸ¥çœ‹è¿›åº¦æŒ‰é’®

<template>
  <div class="home-page">
    <!-- ä»Šæ—¥ä½™é¢å¡ç‰‡ -->
    <div class="balance-card">
      <h2 class="card-title">ğŸ“Š ä»Šæ—¥ä½™é¢</h2>

      <div class="balance-item">
        <div class="balance-icon">ğŸ”¥</div>
        <div class="balance-content">
          <span class="balance-label">å‰©ä½™çƒ­é‡</span>
          <span class="balance-value">{{ balance.remaining_calories.toFixed(0) }} å¤§å¡</span>
        </div>
      </div>

      <div class="balance-item">
        <div class="balance-icon">ğŸ’ª</div>
        <div class="balance-content">
          <span class="balance-label">å‰©ä½™è›‹ç™½è´¨</span>
          <span class="balance-value">{{ balance.remaining_protein.toFixed(0) }}g</span>
        </div>
      </div>

      <div class="balance-progress">
        <div class="progress-bar">
          <div class="progress-fill calories" :style="{ width: caloriesPercent + '%' }"></div>
        </div>
        <div class="progress-text">
          å·²ç”¨ {{ balance.consumed_calories.toFixed(0) }} / {{ balance.target_calories.toFixed(0) }} å¤§å¡
        </div>
      </div>
    </div>

    <!-- æ™ºèƒ½å»ºè®® -->
    <div class="suggestions-card" v-if="suggestions.length > 0">
      <h3 class="card-subtitle">ğŸ§  å¯ä»¥åƒè¿™äº›ï¼š</h3>
      <div class="suggestion-list">
        <button
          v-for="item in suggestions"
          :key="item.id"
          class="suggestion-item"
          @click="quickAdd(item)"
        >
          <span class="suggestion-icon">â•</span>
          <span class="suggestion-name">{{ item.name }}</span>
          <span class="suggestion-calories">{{ item.calories }} å¤§å¡</span>
        </button>
      </div>
    </div>

    <!-- ç«‹åˆ»è®°å½•æŒ‰é’® -->
    <router-link to="/record" class="record-btn">
      <span class="record-icon">ğŸ“·</span>
      <span class="record-text">ç«‹åˆ»è®°å½•</span>
    </router-link>

    <!-- ä»Šæ—¥è®°å½•çŠ¶æ€ -->
    <div class="meals-status">
      <span class="meals-label">ğŸ“… ä»Šæ—¥</span>
      <span class="meals-checks">
        <span v-for="n in balance.meals_count" :key="n" class="check">âœ”</span>
        <span v-if="balance.meals_count === 0" class="check-empty">æš‚æ— è®°å½•</span>
      </span>
    </div>

    <!-- æŸ¥çœ‹è¿›åº¦æŒ‰é’® -->
    <router-link to="/progress" class="progress-link">
      ğŸ“ˆ æŸ¥çœ‹è¿›åº¦
    </router-link>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted } from 'vue'
import { api, type DailyBalanceResponse } from '@/api'

const balance = ref<DailyBalanceResponse>({
  remaining_calories: 2000,
  remaining_protein: 120,
  consumed_calories: 0,
  consumed_protein: 0,
  target_calories: 2000,
  target_protein: 120,
  meals_count: 0
})

const loading = ref(false)

const caloriesPercent = computed(() => {
  return (balance.value.consumed_calories / balance.value.target_calories) * 100
})

// æ™ºèƒ½å»ºè®®ï¼ˆæ ¹æ®å‰©ä½™é¢åº¦åŠ¨æ€ç”Ÿæˆï¼‰
const suggestions = computed(() => {
  const result: { id: number; name: string; calories: number }[] = []
  const remaining = balance.value.remaining_calories

  if (remaining >= 150) {
    result.push({ id: 1, name: 'æ°´ç…®è›‹', calories: 80 })
  }
  if (remaining >= 100) {
    result.push({ id: 2, name: 'å°æ¯é…¸å¥¶', calories: 100 })
  }
  if (remaining >= 200) {
    result.push({ id: 3, name: 'æŒå¿ƒé¸¡èƒ¸è‚‰', calories: 200 })
  }
  if (remaining >= 50) {
    result.push({ id: 4, name: 'ä¸€æ ¹é¦™è•‰', calories: 100 })
  }

  return result.slice(0, 3)
})

// åŠ è½½ä½™é¢æ•°æ®
async function loadBalance() {
  loading.value = true
  try {
    balance.value = await api.getBalance()
  } catch (error) {
    console.error('åŠ è½½ä½™é¢å¤±è´¥:', error)
  } finally {
    loading.value = false
  }
}

// å¿«é€Ÿæ·»åŠ ï¼ˆç®€åŒ–å®ç°ï¼Œå®é™…éœ€è¦çŸ¥é“ä»½é‡IDï¼‰
async function quickAdd(item: { id: number; name: string; calories: number }) {
  // TODO: å®ç°å¿«é€Ÿæ·»åŠ åŠŸèƒ½
  console.log('å¿«é€Ÿæ·»åŠ :', item)
}

onMounted(() => {
  loadBalance()
})
</script>

<style scoped>
.home-page {
  max-width: 400px;
  margin: 0 auto;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.balance-card {
  background: white;
  border-radius: 20px;
  padding: 25px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
}

.card-title {
  margin: 0 0 20px 0;
  font-size: 1.3rem;
  color: #2c3e50;
}

.balance-item {
  display: flex;
  align-items: center;
  gap: 15px;
  margin-bottom: 15px;
}

.balance-icon {
  font-size: 2rem;
  width: 50px;
  height: 50px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #f8f9fa;
  border-radius: 12px;
}

.balance-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.balance-label {
  font-size: 0.85rem;
  color: #7f8c8d;
}

.balance-value {
  font-size: 1.4rem;
  font-weight: bold;
  color: #2c3e50;
}

.balance-progress {
  margin-top: 10px;
}

.progress-bar {
  height: 8px;
  background: #ecf0f1;
  border-radius: 4px;
  overflow: hidden;
  margin-bottom: 8px;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #3498db, #2ecc71);
  border-radius: 4px;
  transition: width 0.3s ease;
}

.progress-text {
  font-size: 0.8rem;
  color: #7f8c8d;
}

.suggestions-card {
  background: white;
  border-radius: 20px;
  padding: 20px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
}

.card-subtitle {
  margin: 0 0 15px 0;
  font-size: 1rem;
  color: #2c3e50;
}

.suggestion-list {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.suggestion-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 15px;
  background: #f8f9fa;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.2s;
}

.suggestion-item:hover {
  background: #e9ecef;
}

.suggestion-icon {
  font-size: 1.2rem;
}

.suggestion-name {
  flex: 1;
  text-align: left;
  font-weight: 500;
  color: #2c3e50;
}

.suggestion-calories {
  font-size: 0.9rem;
  color: #7f8c8d;
}

.record-btn {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 10px;
  padding: 25px;
  background: linear-gradient(135deg, #3498db, #2ecc71);
  color: white;
  border: none;
  border-radius: 20px;
  text-decoration: none;
  font-size: 1.2rem;
  font-weight: bold;
  box-shadow: 0 4px 20px rgba(52, 152, 219, 0.3);
  transition: transform 0.2s;
}

.record-btn:hover {
  transform: scale(1.02);
}

.record-icon {
  font-size: 2.5rem;
}

.meals-status {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px 20px;
  background: #f8f9fa;
  border-radius: 15px;
}

.meals-label {
  font-weight: 500;
  color: #2c3e50;
}

.meals-checks {
  display: flex;
  gap: 8px;
}

.check {
  color: #2ecc71;
  font-weight: bold;
}

.check-empty {
  color: #7f8c8d;
  font-size: 0.9rem;
}

.progress-link {
  text-align: center;
  padding: 15px;
  background: white;
  color: #3498db;
  text-decoration: none;
  border-radius: 15px;
  font-weight: 500;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
  transition: all 0.2s;
}

.progress-link:hover {
  background: #f8f9fa;
}
</style>

================================================================================
æ–‡ä»¶ï¼šsrc/views/Record.vueï¼ˆæ‹ç…§è®°å½•é¡µï¼‰
================================================================================

é¡µé¢åŠŸèƒ½ï¼š
- æ‹ç…§ç•Œé¢ï¼ˆæ–‡ä»¶é€‰æ‹©ï¼‰
- AI è¯†åˆ«é£Ÿç‰©
- é€‰æ‹©ä»½é‡å¤§å°
- ç¡®è®¤è®°å½•
- è®°å½•æˆåŠŸåé¦ˆ

<template>
  <div class="record-page">
    <!-- æœªæ‹ç…§çŠ¶æ€ -->
    <div v-if="!imageData" class="camera-view">
      <div class="camera-placeholder">
        <div class="camera-icon">ğŸ“·</div>
        <p>å¯¹å‡†ä½ çš„é¥­èœæ‹ç…§</p>
      </div>
      <button class="capture-btn" @click="capturePhoto">
        æ‹ç…§
      </button>
      <input
        ref="fileInput"
        type="file"
        accept="image/*"
        style="display: none"
        @change="handleFileSelect"
      >
    </div>

    <!-- è¯†åˆ«ç»“æœçŠ¶æ€ -->
    <div v-else-if="analyzeResult && !selectedPortion" class="result-view">
      <div class="preview-image">
        <img :src="imageData" alt="Food photo" />
      </div>

      <div class="recognition-result">
        <h2>æˆ‘è®¤å‡ºæ¥äº†ï¼š{{ analyzeResult.food_name }}</h2>
        <p>å®ƒçœ‹èµ·æ¥æœ‰å¤šå¤§ï¼Ÿ</p>
      </div>

      <div class="portion-options">
        <button
          v-for="option in analyzeResult.portion_options"
          :key="option.id"
          class="portion-option"
          :class="{ selected: selectedPortion?.id === option.id }"
          @click="selectPortion(option)"
        >
          <span class="option-name">â—‹ {{ option.portion_name }}</span>
          <span class="option-info">çº¦{{ option.weight_grams }}g Â· {{ option.calories.toFixed(0) }}å¤§å¡</span>
        </button>
      </div>

      <div class="action-buttons">
        <button class="btn-secondary" @click="retakePhoto">
          é‡æ–°æ‹ç…§
        </button>
        <button class="btn-primary" @click="confirmRecord" :disabled="!selectedPortion">
          ç¡®è®¤è®°å½•
        </button>
      </div>
    </div>

    <!-- åŠ è½½ä¸­ -->
    <div v-else-if="analyzing" class="loading-view">
      <div class="spinner"></div>
      <p>æ­£åœ¨è¯†åˆ«é£Ÿç‰©...</p>
    </div>

    <!-- è®°å½•æˆåŠŸ -->
    <div v-else-if="recordSuccess" class="success-view">
      <div class="success-icon">âœ“</div>
      <h2>è®°å½•æˆåŠŸï¼</h2>
      <div class="success-info">
        <p>{{ recordedFood }}</p>
        <p class="success-calories">+{{ recordedCalories }} å¤§å¡</p>
      </div>
      <button class="btn-primary" @click="goHome">
        è¿”å›é¦–é¡µ
      </button>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import { useRouter } from 'vue-router'
import { api, type AnalyzeImageResponse, type PortionOption } from '@/api'

const router = useRouter()

const imageData = ref<string>('')
const analyzing = ref(false)
const recordSuccess = ref(false)
const analyzeResult = ref<AnalyzeImageResponse | null>(null)
const selectedPortion = ref<PortionOption | null>(null)
const fileInput = ref<HTMLInputElement | null>(null)
const recordedFood = ref('')
const recordedCalories = ref(0)

// æ‹ç…§
function capturePhoto() {
  fileInput.value?.click()
}

// é€‰æ‹©æ–‡ä»¶
function handleFileSelect(event: Event) {
  const target = event.target as HTMLInputElement
  const file = target.files?.[0]
  if (file) {
    const reader = new FileReader()
    reader.onload = (e) => {
      imageData.value = e.target?.result as string
      analyzeFood(imageData.value)
    }
    reader.readAsDataURL(file)
  }
}

// åˆ†æé£Ÿç‰©
async function analyzeFood(dataUrl: string) {
  analyzing.value = true
  try {
    // è½¬æ¢ä¸º base64ï¼ˆå»æ‰å‰ç¼€ï¼‰
    const base64 = dataUrl.split(',')[1]
    analyzeResult.value = await api.analyzeImage(base64)
  } catch (error) {
    alert('è¯†åˆ«å¤±è´¥ï¼Œè¯·é‡è¯•')
    imageData.value = ''
  } finally {
    analyzing.value = false
  }
}

// é€‰æ‹©ä»½é‡
function selectPortion(option: PortionOption) {
  selectedPortion.value = option
}

// é‡æ–°æ‹ç…§
function retakePhoto() {
  imageData.value = ''
  analyzeResult.value = null
  selectedPortion.value = null
}

// ç¡®è®¤è®°å½•
async function confirmRecord() {
  if (!selectedPortion.value) return

  try {
    await api.createRecord({
      image_url: imageData.value,
      food_name: analyzeResult.value!.food_name,
      visual_portion_id: selectedPortion.value.id
    })

    recordedFood.value = analyzeResult.value!.food_name
    recordedCalories.value = selectedPortion.value.calories
    recordSuccess.value = true
  } catch (error) {
    alert('è®°å½•å¤±è´¥ï¼Œè¯·é‡è¯•')
  }
}

// è¿”å›é¦–é¡µ
function goHome() {
  router.push('/')
}
</script>

<style scoped>
.record-page {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  background: #f5f7fa;
}

.camera-view {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
  gap: 30px;
}

.camera-placeholder {
  text-align: center;
}

.camera-icon {
  font-size: 6rem;
  margin-bottom: 20px;
}

.camera-placeholder p {
  font-size: 1.2rem;
  color: #7f8c8d;
}

.capture-btn {
  padding: 20px 60px;
  font-size: 1.3rem;
  background: #3498db;
  color: white;
  border: none;
  border-radius: 50px;
  cursor: pointer;
  box-shadow: 0 4px 20px rgba(52, 152, 219, 0.3);
}

.result-view {
  flex: 1;
  display: flex;
  flex-direction: column;
  padding: 20px;
  gap: 20px;
}

.preview-image {
  width: 100%;
  max-height: 300px;
  overflow: hidden;
  border-radius: 20px;
  background: #000;
}

.preview-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.recognition-result {
  text-align: center;
  padding: 20px;
}

.recognition-result h2 {
  margin: 0 0 10px 0;
  font-size: 1.5rem;
  color: #2c3e50;
}

.recognition-result p {
  margin: 0;
  color: #7f8c8d;
}

.portion-options {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.portion-option {
  padding: 18px 20px;
  background: white;
  border: 2px solid #ecf0f1;
  border-radius: 15px;
  text-align: left;
  cursor: pointer;
  transition: all 0.2s;
}

.portion-option.selected {
  border-color: #3498db;
  background: #f0f9ff;
}

.portion-option.selected .option-name::before {
  content: 'â— ';
}

.option-name {
  display: block;
  font-weight: 500;
  color: #2c3e50;
  font-size: 1.1rem;
}

.option-info {
  display: block;
  margin-top: 5px;
  color: #7f8c8d;
  font-size: 0.9rem;
}

.action-buttons {
  display: flex;
  gap: 15px;
  margin-top: auto;
}

.btn-primary,
.btn-secondary {
  flex: 1;
  padding: 18px;
  font-size: 1.1rem;
  border: none;
  border-radius: 15px;
  cursor: pointer;
  font-weight: 500;
}

.btn-primary {
  background: #3498db;
  color: white;
}

.btn-primary:disabled {
  background: #bdc3c7;
  cursor: not-allowed;
}

.btn-secondary {
  background: white;
  color: #7f8c8d;
  border: 2px solid #ecf0f1;
}

.loading-view {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 20px;
}

.spinner {
  width: 50px;
  height: 50px;
  border: 4px solid #ecf0f1;
  border-top-color: #3498db;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.success-view {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
  gap: 20px;
}

.success-icon {
  width: 80px;
  height: 80px;
  background: #2ecc71;
  color: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 3rem;
  font-weight: bold;
}

.success-view h2 {
  margin: 0;
  font-size: 1.5rem;
  color: #2c3e50;
}

.success-info {
  text-align: center;
}

.success-info p {
  margin: 5px 0;
  color: #7f8c8d;
}

.success-calories {
  font-size: 1.5rem;
  font-weight: bold;
  color: #3498db !important;
}
</style>

================================================================================
æ–‡ä»¶ï¼šsrc/views/Progress.vueï¼ˆè¿›åº¦è¿½è¸ªé¡µï¼‰
================================================================================

é¡µé¢åŠŸèƒ½ï¼š
- æ—¶é—´èŒƒå›´é€‰æ‹©ï¼ˆæœ¬å‘¨/æœ¬æœˆ/å…¨éƒ¨ï¼‰
- æ˜¾ç¤ºç´¯è®¡çƒ­é‡ç¼ºå£
- æ˜¾ç¤ºé¢„ä¼°å‡è„‚é‡é‡
- ç®€æ˜“è¶‹åŠ¿å›¾ï¼ˆæŸ±çŠ¶å›¾ï¼‰
- åŠ¨æ€é¼“åŠ±è¯­
- è®°å½•å¤©æ•°ç»Ÿè®¡

<template>
  <div class="progress-page">
    <header class="page-header">
      <h1>ğŸ“ˆ è¿›åº¦è¿½è¸ª</h1>
      <router-link to="/" class="back-link">è¿”å›é¦–é¡µ</router-link>
    </header>

    <!-- æ—¶é—´èŒƒå›´é€‰æ‹© -->
    <div class="range-tabs">
      <button
        v-for="range in ranges"
        :key="range.value"
        class="range-tab"
        :class="{ active: currentRange === range.value }"
        @click="switchRange(range.value)"
      >
        {{ range.label }}
      </button>
    </div>

    <!-- æ ¸å¿ƒæ•°æ® -->
    <div class="stats-card">
      <div class="deficit-display">
        <span class="deficit-value" :class="{ negative: progress.total_calorie_deficit < 0 }">
          {{ progress.total_calorie_deficit > 0 ? '+' : '' }}{{ progress.total_calorie_deficit.toFixed(0) }}
        </span>
        <span class="deficit-unit">kcal</span>
      </div>
      <p class="fat-lost">
        ç›¸å½“äºçº¦å‡è„‚ {{ Math.abs(progress.estimated_fat_lost).toFixed(2) }} kg
      </p>
    </div>

    <!-- ç®€æ˜“è¶‹åŠ¿å›¾ -->
    <div class="chart-card" v-if="progress.data_points.length > 0">
      <h3>çƒ­é‡ç¼ºå£è¶‹åŠ¿</h3>
      <div class="simple-chart">
        <div class="chart-bars">
          <div
            v-for="(point, index) in progress.data_points"
            :key="index"
            class="chart-bar-wrapper"
          >
            <div
              class="chart-bar"
              :class="{ positive: point.calorie_deficit > 0, negative: point.calorie_deficit < 0 }"
              :style="{
                height: getBarHeight(point.calorie_deficit) + '%'
              }"
            ></div>
            <span class="bar-label">{{ formatDate(point.date) }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- é¼“åŠ±è¯­ -->
    <div class="encouragement-card">
      <p>{{ progress.encouragement }}</p>
    </div>

    <!-- è®°å½•å¤©æ•° -->
    <div class="days-tracked">
      å·²è®°å½• <strong>{{ progress.days_tracked }}</strong> å¤©
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue'
import { api, type ProgressResponse } from '@/api'

const ranges = [
  { label: 'æœ¬å‘¨', value: 'week' },
  { label: 'æœ¬æœˆ', value: 'month' },
  { label: 'å…¨éƒ¨', value: 'all' }
]

const currentRange = ref<'week' | 'month' | 'all'>('all')
const progress = ref<ProgressResponse>({
  total_calorie_deficit: 0,
  estimated_fat_lost: 0,
  days_tracked: 0,
  data_points: [],
  encouragement: 'å¥½çš„å¼€å§‹ï¼Œç»§ç»­ä¿æŒï¼'
})

const loading = ref(false)
const maxDeficit = ref(500) // ç”¨äºè®¡ç®—å›¾è¡¨é«˜åº¦

// åŠ è½½è¿›åº¦æ•°æ®
async function loadProgress() {
  loading.value = true
  try {
    progress.value = await api.getProgress(currentRange.value)

    // è®¡ç®—æœ€å¤§ç¼ºå£å€¼ï¼ˆç”¨äºå›¾è¡¨ç¼©æ”¾ï¼‰
    if (progress.value.data_points.length > 0) {
      const maxValue = Math.max(
        ...progress.value.data_points.map(p => Math.abs(p.calorie_deficit))
      )
      maxDeficit.value = Math.max(maxValue, 500)
    }
  } catch (error) {
    console.error('åŠ è½½è¿›åº¦å¤±è´¥:', error)
  } finally {
    loading.value = false
  }
}

// åˆ‡æ¢æ—¶é—´èŒƒå›´
function switchRange(range: 'week' | 'month' | 'all') {
  currentRange.value = range
  loadProgress()
}

// è®¡ç®—æŸ±çŠ¶å›¾é«˜åº¦
function getBarHeight(deficit: number) {
  return Math.min(Math.abs(deficit) / maxDeficit.value * 100, 100)
}

// æ ¼å¼åŒ–æ—¥æœŸ
function formatDate(dateStr: string) {
  const date = new Date(dateStr)
  return `${date.getMonth() + 1}/${date.getDate()}`
}

onMounted(() => {
  loadProgress()
})
</script>

<style scoped>
.progress-page {
  min-height: 100vh;
  padding: 20px;
  background: #f5f7fa;
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.page-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.page-header h1 {
  margin: 0;
  font-size: 1.5rem;
  color: #2c3e50;
}

.back-link {
  color: #3498db;
  text-decoration: none;
  font-weight: 500;
}

.range-tabs {
  display: flex;
  gap: 10px;
  background: white;
  padding: 8px;
  border-radius: 15px;
}

.range-tab {
  flex: 1;
  padding: 12px;
  border: none;
  background: transparent;
  border-radius: 12px;
  cursor: pointer;
  font-weight: 500;
  color: #7f8c8d;
  transition: all 0.2s;
}

.range-tab.active {
  background: #3498db;
  color: white;
}

.stats-card {
  background: white;
  border-radius: 20px;
  padding: 30px;
  text-align: center;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
}

.deficit-display {
  display: flex;
  align-items: baseline;
  justify-content: center;
  gap: 8px;
}

.deficit-value {
  font-size: 3rem;
  font-weight: bold;
  color: #2ecc71;
}

.deficit-value.negative {
  color: #e74c3c;
}

.deficit-unit {
  font-size: 1.2rem;
  color: #7f8c8d;
}

.fat-lost {
  margin: 15px 0 0 0;
  color: #7f8c8d;
}

.chart-card {
  background: white;
  border-radius: 20px;
  padding: 25px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
}

.chart-card h3 {
  margin: 0 0 20px 0;
  font-size: 1.1rem;
  color: #2c3e50;
}

.simple-chart {
  height: 150px;
}

.chart-bars {
  display: flex;
  align-items: flex-end;
  justify-content: space-around;
  height: 120px;
  gap: 8px;
}

.chart-bar-wrapper {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
}

.chart-bar {
  width: 100%;
  min-height: 4px;
  border-radius: 4px 4px 0 0;
  transition: height 0.3s ease;
}

.chart-bar.positive {
  background: #e74c3c;
}

.chart-bar.negative {
  background: #2ecc71;
}

.bar-label {
  font-size: 0.7rem;
  color: #7f8c8d;
}

.encouragement-card {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-radius: 20px;
  padding: 20px;
  text-align: center;
  box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
}

.encouragement-card p {
  margin: 0;
  font-size: 1.1rem;
}

.days-tracked {
  text-align: center;
  padding: 15px;
  color: #7f8c8d;
}

.days-tracked strong {
  color: #2c3e50;
}
</style>

================================================================================
æ–‡ä»¶ï¼šsrc/views/Goal.vueï¼ˆç›®æ ‡è®¾ç½®é¡µï¼‰
================================================================================

é¡µé¢åŠŸèƒ½ï¼š
- æ˜¾ç¤ºå½“å‰ç›®æ ‡ï¼ˆçƒ­é‡ã€è›‹ç™½è´¨ï¼‰
- èº«ä½“æ•°æ®è¾“å…¥ï¼ˆæ€§åˆ«ã€å¹´é¾„ã€èº«é«˜ã€ä½“é‡ï¼‰
- çƒ­é‡ç¼ºå£é€‰æ‹©ï¼ˆç»´æŒã€æ¸©å’Œã€é€‚åº¦ã€ç§¯æï¼‰
- å®æ—¶è®¡ç®—æ¯æ—¥ç›®æ ‡é¢„è§ˆ
- å¥åº·è­¦å‘Šï¼ˆç¼ºå£è¿‡å¤§æ—¶ï¼‰
- ä¿å­˜ç›®æ ‡

<template>
  <div class="goal-page">
    <header class="page-header">
      <h1>è®¾ç½®ä½ çš„ç›®æ ‡</h1>
    </header>

    <!-- å·²æœ‰ç›®æ ‡æ˜¾ç¤º -->
    <div v-if="currentGoal && !editing" class="current-goal-card">
      <h2>ğŸ“Š ä½ çš„æ¯æ—¥ç›®æ ‡</h2>
      <div class="goal-values">
        <div class="goal-item">
          <span class="goal-icon">ğŸ”¥</span>
          <div class="goal-content">
            <span class="goal-label">çƒ­é‡</span>
            <span class="goal-value">{{ currentGoal.calorie_target.toFixed(0) }} kcal</span>
          </div>
        </div>
        <div class="goal-item">
          <span class="goal-icon">ğŸ’ª</span>
          <div class="goal-content">
            <span class="goal-label">è›‹ç™½è´¨</span>
            <span class="goal-value">{{ currentGoal.protein_target.toFixed(0) }}g</span>
          </div>
        </div>
      </div>
      <p class="goal-note">
        è¿™æ˜¯æ ¹æ®ä½ çš„èº«ä½“æ•°æ®å’Œé€‰å®šçš„çƒ­é‡ç¼ºå£è®¡ç®—çš„ã€‚
      </p>
      <button class="btn-secondary" @click="editing = true">
        ä¿®æ”¹ç›®æ ‡
      </button>
    </div>

    <!-- è®¾ç½®è¡¨å• -->
    <div v-else class="goal-form">
      <section class="form-section">
        <h3>å…³äºä½ çš„åŸºæœ¬ä¿¡æ¯ï¼š</h3>

        <div class="form-group">
          <label>æ€§åˆ«</label>
          <div class="gender-options">
            <button
              class="gender-btn"
              :class="{ active: formData.gender === 'ç”·' }"
              @click="formData.gender = 'ç”·'"
            >
              ç”·
            </button>
            <button
              class="gender-btn"
              :class="{ active: formData.gender === 'å¥³' }"
              @click="formData.gender = 'å¥³'"
            >
              å¥³
            </button>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>å¹´é¾„</label>
            <input
              v-model.number="formData.age"
              type="number"
              class="form-input"
              placeholder="28"
            >
            <span class="input-unit">å²</span>
          </div>

          <div class="form-group">
            <label>èº«é«˜</label>
            <input
              v-model.number="formData.height_cm"
              type="number"
              class="form-input"
              placeholder="170"
            >
            <span class="input-unit">cm</span>
          </div>
        </div>

        <div class="form-group">
          <label>ä½“é‡</label>
          <input
            v-model.number="formData.weight_kg"
            type="number"
            class="form-input"
            placeholder="70"
          >
          <span class="input-unit">kg</span>
        </div>
      </section>

      <section class="form-section">
        <h3>ä½ æƒ³æ€ä¹ˆåƒï¼Ÿ</h3>
        <p class="section-note">æ¯å¤©çƒ­é‡ç¼ºå£ï¼š</p>

        <div class="deficit-options">
          <button
            v-for="option in deficitOptions"
            :key="option.value"
            class="deficit-option"
            :class="{ active: formData.deficit_target === option.value }"
            @click="formData.deficit_target = option.value"
          >
            <span class="option-label">{{ option.label }}</span>
            <span class="option-desc">{{ option.desc }}</span>
          </button>
        </div>
      </section>

      <!-- è­¦å‘Šæç¤º -->
      <div v-if="showWarning" class="warning-card">
        <h3>âš ï¸ å¥åº·æé†’</h3>
        <p>ä½ è®¾ç½®çš„çƒ­é‡ç¼ºå£ï¼ˆ{{ formData.deficit_target }}ï¼‰è¶…è¿‡äº†å®‰å…¨å»ºè®®å€¼ï¼ˆ-500ï¼‰ã€‚</p>
        <p class="warning-text">è¿‡å¤§çš„ç¼ºå£å¯èƒ½å¯¼è‡´ï¼š</p>
        <ul>
          <li>è‚Œè‚‰æµå¤±</li>
          <li>åŸºç¡€ä»£è°¢ä¸‹é™</li>
          <li>è¥å…»ä¸è‰¯</li>
        </ul>
        <p class="warning-suggestion">å»ºè®®ä½ é€‰æ‹©ï¼š</p>
        <div class="warning-actions">
          <button class="btn-warning" @click="formData.deficit_target = -500">
            -500 kcal/å¤©
          </button>
          <button class="btn-secondary" @click="showWarning = false">
            ä»ä½¿ç”¨ {{ formData.deficit_target }} kcal/å¤©
          </button>
        </div>
      </div>

      <!-- è®¡ç®—ç»“æœé¢„è§ˆ -->
      <div v-if="calculatedTargets && !showWarning" class="preview-card">
        <h3>ğŸ“Š ä½ çš„æ¯æ—¥ç›®æ ‡</h3>
        <div class="preview-values">
          <div class="preview-item">
            <span>ğŸ”¥ çƒ­é‡ï¼š</span>
            <strong>{{ calculatedTargets.calories.toFixed(0) }} kcal</strong>
          </div>
          <div class="preview-item">
            <span>ğŸ’ª è›‹ç™½è´¨ï¼š</span>
            <strong>{{ calculatedTargets.protein.toFixed(0) }}g</strong>
          </div>
        </div>
        <p class="preview-note">
          è¿™æ˜¯æ ¹æ®ä½ çš„èº«ä½“æ•°æ®å’Œé€‰å®šçš„çƒ­é‡ç¼ºå£è®¡ç®—çš„ã€‚
        </p>
      </div>

      <button class="btn-primary" @click="saveGoal" :disabled="!isValid">
        ç¡®è®¤å¹¶ä¿å­˜
      </button>

      <button v-if="currentGoal" class="btn-link" @click="cancelEdit">
        å–æ¶ˆ
      </button>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted, watch } from 'vue'
import { api, type GoalResponse } from '@/api'

const currentGoal = ref<GoalResponse | null>(null)
const editing = ref(false)
const showWarning = ref(false)

const formData = ref({
  gender: 'ç”·',
  age: 28,
  height_cm: 175,
  weight_kg: 70,
  deficit_target: -500
})

const deficitOptions = [
  { value: 0, label: 'ç»´æŒä½“é‡', desc: 'æ— ç¼ºå£' },
  { value: -300, label: 'æ¸©å’Œå‡é‡', desc: '-300kcal/å¤©' },
  { value: -500, label: 'é€‚åº¦å‡é‡', desc: '-500kcal/å¤©' },
  { value: -800, label: 'ç§¯æå‡é‡', desc: '-800kcal/å¤©' }
]

// è®¡ç®—ç›®æ ‡
const calculatedTargets = computed(() => {
  const { gender, age, height_cm, weight_kg, deficit_target } = formData.value

  // è®¡ç®— BMR (Mifflin-St Jeor å…¬å¼)
  let bmr: number
  if (gender === 'ç”·') {
    bmr = 10 * weight_kg + 6.25 * height_cm - 5 * age + 5
  } else {
    bmr = 10 * weight_kg + 6.25 * height_cm - 5 * age - 161
  }

  // TDEE (å‡è®¾ä¹…åï¼Œæ´»åŠ¨ç³»æ•° 1.2)
  const tdee = bmr * 1.2

  // è›‹ç™½è´¨ç›®æ ‡ (1.6g/kg)
  const protein = weight_kg * 1.6

  return {
    calories: tdee + deficit_target,
    protein: protein
  }
})

// è¡¨å•éªŒè¯
const isValid = computed(() => {
  const { gender, age, height_cm, weight_kg, deficit_target } = formData.value
  return (
    (gender === 'ç”·' || gender === 'å¥³') &&
    age > 0 && age < 120 &&
    height_cm > 0 && height_cm < 250 &&
    weight_kg > 0 && weight_kg < 300 &&
    [0, -300, -500, -800].includes(deficit_target)
  )
})

// ç›‘å¬ç¼ºå£å€¼å˜åŒ–ï¼Œæ˜¾ç¤ºè­¦å‘Š
watch(() => formData.value.deficit_target, (newVal) => {
  if (newVal < -500) {
    showWarning.value = true
  }
})

// åŠ è½½å½“å‰ç›®æ ‡
async function loadGoal() {
  try {
    currentGoal.value = await api.getGoal()
    if (currentGoal.value) {
      // å¡«å……è¡¨å•
      formData.value = {
        gender: currentGoal.value.gender,
        age: currentGoal.value.age,
        height_cm: currentGoal.value.height_cm,
        weight_kg: currentGoal.value.weight_kg,
        deficit_target: currentGoal.value.deficit_target
      }
    }
  } catch (error) {
    console.error('åŠ è½½ç›®æ ‡å¤±è´¥:', error)
  }
}

// ä¿å­˜ç›®æ ‡
async function saveGoal() {
  if (!isValid.value) return

  if (formData.value.deficit_target < -500 && !confirm('æ‚¨è®¾ç½®çš„çƒ­é‡ç¼ºå£è¾ƒå¤§ï¼Œç¡®å®šè¦ç»§ç»­å—ï¼Ÿ')) {
    return
  }

  try {
    await api.setGoal(formData.value)
    await loadGoal()
    editing.value = false
    alert('ç›®æ ‡å·²ä¿å­˜ï¼')
  } catch (error) {
    alert('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•')
  }
}

// å–æ¶ˆç¼–è¾‘
function cancelEdit() {
  if (currentGoal.value) {
    formData.value = {
      gender: currentGoal.value.gender,
      age: currentGoal.value.age,
      height_cm: currentGoal.value.height_cm,
      weight_kg: currentGoal.value.weight_kg,
      deficit_target: currentGoal.value.deficit_target
    }
  }
  editing.value = false
  showWarning.value = false
}

onMounted(() => {
  loadGoal()
})
</script>

<style scoped>
.goal-page {
  min-height: 100vh;
  padding: 20px;
  background: #f5f7fa;
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.page-header h1 {
  margin: 0;
  font-size: 1.5rem;
  color: #2c3e50;
}

.current-goal-card {
  background: white;
  border-radius: 20px;
  padding: 30px;
  text-align: center;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
}

.current-goal-card h2 {
  margin: 0 0 25px 0;
  font-size: 1.3rem;
  color: #2c3e50;
}

.goal-values {
  display: flex;
  justify-content: center;
  gap: 30px;
  margin-bottom: 20px;
}

.goal-item {
  display: flex;
  align-items: center;
  gap: 15px;
}

.goal-icon {
  font-size: 2.5rem;
}

.goal-content {
  display: flex;
  flex-direction: column;
  gap: 5px;
}

.goal-label {
  font-size: 0.85rem;
  color: #7f8c8d;
}

.goal-value {
  font-size: 1.5rem;
  font-weight: bold;
  color: #2c3e50;
}

.goal-note {
  color: #7f8c8d;
  margin-bottom: 20px;
}

.goal-form {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.form-section {
  background: white;
  border-radius: 20px;
  padding: 25px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
}

.form-section h3 {
  margin: 0 0 20px 0;
  font-size: 1.1rem;
  color: #2c3e50;
}

.section-note {
  margin: 0 0 15px 0;
  color: #7f8c8d;
}

.form-group {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 15px;
}

.form-group label {
  min-width: 60px;
  font-weight: 500;
  color: #2c3e50;
}

.form-input {
  flex: 1;
  padding: 12px 15px;
  border: 2px solid #ecf0f1;
  border-radius: 10px;
  font-size: 1rem;
}

.form-input:focus {
  outline: none;
  border-color: #3498db;
}

.input-unit {
  color: #7f8c8d;
  min-width: 30px;
}

.form-row {
  display: flex;
  gap: 15px;
}

.form-row .form-group {
  flex: 1;
}

.gender-options {
  display: flex;
  gap: 10px;
  flex: 1;
}

.gender-btn {
  flex: 1;
  padding: 12px;
  border: 2px solid #ecf0f1;
  background: white;
  border-radius: 10px;
  font-size: 1rem;
  cursor: pointer;
  transition: all 0.2s;
}

.gender-btn.active {
  border-color: #3498db;
  background: #f0f9ff;
  color: #3498db;
}

.deficit-options {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.deficit-option {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px 18px;
  border: 2px solid #ecf0f1;
  background: white;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.2s;
}

.deficit-option.active {
  border-color: #3498db;
  background: #f0f9ff;
}

.option-label {
  font-weight: 500;
  color: #2c3e50;
}

.option-desc {
  color: #7f8c8d;
}

.warning-card {
  background: #fff3cd;
  border: 2px solid #ffc107;
  border-radius: 20px;
  padding: 25px;
}

.warning-card h3 {
  margin: 0 0 15px 0;
  color: #856404;
}

.warning-card p {
  margin: 10px 0;
  color: #856404;
}

.warning-text {
  font-weight: 500;
}

.warning-card ul {
  margin: 10px 0;
  padding-left: 20px;
  color: #856404;
}

.warning-suggestion {
  font-weight: 500;
  margin-top: 15px !important;
}

.warning-actions {
  display: flex;
  gap: 10px;
  margin-top: 15px;
}

.preview-card {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-radius: 20px;
  padding: 25px;
}

.preview-card h3 {
  margin: 0 0 20px 0;
  font-size: 1.2rem;
}

.preview-values {
  display: flex;
  justify-content: space-around;
  margin-bottom: 15px;
}

.preview-item {
  font-size: 1.1rem;
}

.preview-item strong {
  font-size: 1.3rem;
}

.preview-note {
  margin: 0;
  opacity: 0.9;
}

.btn-primary,
.btn-secondary,
.btn-warning,
.btn-link {
  padding: 18px;
  border: none;
  border-radius: 15px;
  font-size: 1.1rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-primary {
  background: #3498db;
  color: white;
}

.btn-primary:disabled {
  background: #bdc3c7;
  cursor: not-allowed;
}

.btn-secondary {
  background: white;
  color: #7f8c8d;
  border: 2px solid #ecf0f1;
}

.btn-warning {
  background: #ffc107;
  color: #212529;
}

.btn-link {
  background: transparent;
  color: #7f8c8d;
  text-decoration: underline;
}
</style>

================================================================================
æ–‡ä»¶ï¼šsrc/router/index.tsï¼ˆè·¯ç”±é…ç½®ï¼‰
================================================================================

/**
 * è·¯ç”±é…ç½®
 */
import { createRouter, createWebHistory } from 'vue-router'
import type { RouteRecordRaw } from 'vue-router'

const routes: RouteRecordRaw[] = [
  {
    path: '/',
    name: 'Home',
    component: () => import('@/views/Home.vue')
  },
  {
    path: '/record',
    name: 'Record',
    component: () => import('@/views/Record.vue')
  },
  {
    path: '/progress',
    name: 'Progress',
    component: () => import('@/views/Progress.vue')
  },
  {
    path: '/goal',
    name: 'Goal',
    component: () => import('@/views/Goal.vue')
  },
]

const router = createRouter({
  history: createWebHistory(import.meta.env.BASE_URL),
  routes
})

export default router

================================================================================
æ–‡ä»¶ï¼šsrc/App.vueï¼ˆæ ¹ç»„ä»¶ï¼‰
================================================================================

<template>
  <div id="app">
    <router-view />
  </div>
</template>

<script setup lang="ts">
// App.vue æ ¹ç»„ä»¶
</script>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  background: #f5f7fa;
  color: #2c3e50;
  line-height: 1.6;
}

#app {
  min-height: 100vh;
}
</style>

================================================================================
API æ¥å£å¯¹æ¥è¯´æ˜
================================================================================

åç«¯ API åŸºç¡€åœ°å€ï¼šhttp://localhost:8000/api

| æ–¹æ³• | ç«¯ç‚¹ | åŠŸèƒ½ |
|------|------|------|
| POST | /analyze | åˆ†æé£Ÿç‰©å›¾ç‰‡ï¼Œè¿”å›è¯†åˆ«ç»“æœå’Œä»½é‡é€‰é¡¹ |
| POST | /records | åˆ›å»ºé¥®é£Ÿè®°å½• |
| GET | /balance | è·å–ä»Šæ—¥ä½™é¢ |
| GET | /progress?range=all | è·å–è¿›åº¦ç»Ÿè®¡ |
| POST | /goals | è®¾ç½®ç›®æ ‡ |
| GET | /goals | è·å–å½“å‰ç›®æ ‡ |

================================================================================
é¡µé¢è·¯ç”±å¯¹åº”å…³ç³»
================================================================================

| è·¯å¾„ | ç»„ä»¶ | åŠŸèƒ½ |
|------|------|------|
| / | Home.vue | é¦–é¡µ - ä»Šæ—¥ä½™é¢ã€æ™ºèƒ½å»ºè®®ã€ç«‹åˆ»è®°å½• |
| /record | Record.vue | æ‹ç…§è®°å½• - ç›¸æœºã€AIè¯†åˆ«ã€ä»½é‡é€‰æ‹© |
| /progress | Progress.vue | è¿›åº¦è¿½è¸ª - è¶‹åŠ¿å›¾ã€ç»Ÿè®¡æ•°æ® |
| /goal | Goal.vue | ç›®æ ‡è®¾ç½® - èº«ä½“æ•°æ®ã€ç¼ºå£é€‰æ‹© |

================================================================================
è¿è¡Œæ–¹å¼
================================================================================

cd æ™ºèƒ½é£Ÿç‰©è®°å½•/frontend

# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

å‰ç«¯å°†åœ¨ http://localhost:5173 è¿è¡Œ
éœ€è¦åç«¯æœåŠ¡åŒæ—¶è¿è¡Œåœ¨ http://localhost:8000

================================================================================
æ›´æ–°è®°å½•
================================================================================

ã€2026-01-16ã€‘å‰ç«¯ä»£ç ä¿®å¤ - ç¬¦åˆ PRD åå·®ä¿®æ­£
--------------------------------------------------------------------------------

1. Home.vue - å¿«é€ŸåŠ é¤åŠŸèƒ½å®ç°
   é—®é¢˜ï¼šquickAdd å‡½æ•°æœªå®ç°ï¼Œæ™ºèƒ½å»ºè®®æŒ‰é’®ç‚¹å‡»æ— æ•ˆ
   ä¿®å¤ï¼š
   - æ·»åŠ  QUICK_ADD_MAPPING å¸¸é‡ï¼Œæ˜ å°„é£Ÿç‰©åç§°åˆ°ä»½é‡ ID
   - å®ç° quickAdd() å‡½æ•°ï¼Œè°ƒç”¨ api.createRecord() åˆ›å»ºè®°å½•
   - æ·»åŠ åŠ è½½çŠ¶æ€ï¼ˆâ³ å›¾æ ‡ï¼‰å’Œç¦ç”¨çŠ¶æ€
   - è®°å½•æˆåŠŸåè°ƒç”¨ loadBalance() åˆ·æ–°ä½™é¢æ•°æ®

   æ–°å¢ä»£ç ï¼š
   ```typescript
   const QUICK_ADD_MAPPING: Record<string, { portionId: number; calories: number; protein: number }> = {
     'æ°´ç…®è›‹': { portionId: 11, calories: 78, protein: 6.5 },
     'å°æ¯é…¸å¥¶': { portionId: 999, calories: 100, protein: 5 },
     'æŒå¿ƒé¸¡èƒ¸è‚‰': { portionId: 2, calories: 198, protein: 37 },
     'ä¸€æ ¹é¦™è•‰': { portionId: 37, calories: 107, protein: 1.3 }
   }

   async function quickAdd(item: { id: number; name: string; calories: number; adding: boolean }) {
     const mapping = QUICK_ADD_MAPPING[item.name]
     if (!mapping) {
       alert(`ã€Œ${item.name}ã€æš‚æœªå½•å…¥çŸ¥è¯†åº“ï¼Œè¯·ä½¿ç”¨æ‹ç…§è®°å½•`)
       return
     }
     item.adding = true
     try {
       await api.createRecord({
         image_url: '',
         food_name: item.name,
         visual_portion_id: mapping.portionId
       })
       await loadBalance()
     } catch (error) {
       alert('æ·»åŠ å¤±è´¥ï¼Œè¯·é‡è¯•')
     } finally {
       item.adding = false
     }
   }
   ```

2. Record.vue - å¤šèœå“è®°å½•æµç¨‹
   é—®é¢˜ï¼šè®°å½•æˆåŠŸååªèƒ½è¿”å›é¦–é¡µï¼Œæ— æ³•ç»§ç»­æ·»åŠ åŒä¸€é¤çš„å…¶ä»–èœå“
   ä¿®å¤ï¼š
   - æˆåŠŸé¡µé¢æ·»åŠ ä¸¤ä¸ªæŒ‰é’®ï¼š"ç»§ç»­æ·»åŠ " å’Œ "å®Œæˆç”¨é¤"
   - æ·»åŠ  continueAdding() å‡½æ•°ï¼Œé‡ç½®çŠ¶æ€ä»¥ç»§ç»­æ·»åŠ 
   - æ·»åŠ  success-actions æ ·å¼ç±»ï¼ŒåŒæŒ‰é’®å¹¶æ’æ˜¾ç¤º

   æ–°å¢ä»£ç ï¼š
   ```vue
   <div class="success-actions">
     <button class="btn-secondary" @click="continueAdding">
       ç»§ç»­æ·»åŠ 
     </button>
     <button class="btn-primary" @click="goHome">
       å®Œæˆç”¨é¤
     </button>
   </div>
   ```

   ```typescript
   function continueAdding() {
     imageData.value = ''
     analyzeResult.value = null
     selectedPortion.value = null
     recordSuccess.value = false
     recordedFood.value = ''
     recordedCalories.value = 0
   }
   ```

3. Progress.vue - æ•°æ®é€»è¾‘ä¿®æ­£
   é—®é¢˜ï¼šçƒ­é‡ç¼ºå£æ˜¾ç¤ºæ­£å€¼ï¼Œé¢œè‰²è¯­ä¹‰é”™è¯¯
   ä¿®å¤ï¼š
   - çƒ­é‡ç¼ºå£ç»Ÿä¸€æ˜¾ç¤ºä¸ºè´Ÿå€¼ï¼ˆå¦‚ -3,500 kcalï¼‰
   - è´Ÿå€¼ï¼ˆç¼ºå£ï¼‰æ˜¾ç¤ºç»¿è‰²ï¼Œæ­£å€¼ï¼ˆç›ˆä½™ï¼‰æ˜¾ç¤ºçº¢è‰²
   - æ–‡æ¡ˆæ ¹æ®çŠ¶æ€åŠ¨æ€å˜åŒ–ï¼š"ç´¯è®¡çƒ­é‡ç¼ºå£/ç´¯è®¡çƒ­é‡ç›ˆä½™"ã€"å‡è„‚/å¢è„‚"
   - CSS ç±»åä» .negative æ”¹ä¸º .surplusï¼Œè¯­ä¹‰æ›´æ¸…æ™°

   ä¿®æ”¹ï¼š
   ```vue
   <span class="deficit-value" :class="{ surplus: progress.total_calorie_deficit > 0 }">
     {{ progress.total_calorie_deficit.toFixed(0) }}
   </span>
   <p class="fat-lost">
     {{ progress.total_calorie_deficit < 0 ? 'ç´¯è®¡çƒ­é‡ç¼ºå£' : 'ç´¯è®¡çƒ­é‡ç›ˆä½™' }}
   </p>
   <p class="fat-lost">
     ç›¸å½“äºçº¦{{ progress.total_calorie_deficit < 0 ? 'å‡è„‚' : 'å¢è„‚' }} {{ Math.abs(progress.estimated_fat_lost).toFixed(2) }} kg
   </p>
   ```

   ```css
   .deficit-value {
     color: #2ecc71;  /* ç¼ºå£ï¼ˆè´Ÿå€¼ï¼‰é»˜è®¤ç»¿è‰² */
   }
   .deficit-value.surplus {
     color: #e74c3c;  /* ç›ˆä½™ï¼ˆæ­£å€¼ï¼‰çº¢è‰² */
   }
   ```

4. Goal.vue - æ¨¡æ€å¼¹çª—è­¦å‘Š
   é—®é¢˜ï¼šå¥åº·è­¦å‘Šä»¥å†…è”å¡ç‰‡å½¢å¼æ˜¾ç¤ºï¼Œä¸ç¬¦åˆ PRD è¦æ±‚çš„æ¨¡æ€å¼¹çª—
   ä¿®å¤ï¼š
   - å°†å†…è”è­¦å‘Šå¡ç‰‡æ”¹ä¸ºæ¨¡æ€å¼¹çª—
   - æ·»åŠ åŠé€æ˜é®ç½©å±‚ï¼ˆç‚¹å‡»é®ç½©å¯å…³é—­ï¼‰
   - å¼¹çª—æ»‘å…¥åŠ¨ç”»æ•ˆæœ
   - ä¸¤ä¸ªæ¸…æ™°çš„æŒ‰é’®ï¼š"ä»ä½¿ç”¨ X kcal/å¤©" å’Œ "ä½¿ç”¨å®‰å…¨å€¼ -500 kcal/å¤©"
   - æ–°å¢ closeWarning() å’Œ useRecommendedDeficit() å‡½æ•°

   æ–°å¢ä»£ç ï¼š
   ```vue
   <div v-if="showWarning" class="modal-overlay" @click.self="closeWarning">
     <div class="modal-content">
       <div class="modal-header">
         <h3>âš ï¸ å¥åº·æé†’</h3>
       </div>
       <div class="modal-body">
         <p>ä½ è®¾ç½®çš„çƒ­é‡ç¼ºå£ï¼ˆ{{ formData.deficit_target }} kcal/å¤©ï¼‰è¶…è¿‡äº†å®‰å…¨å»ºè®®å€¼ï¼ˆ-500 kcal/å¤©ï¼‰ã€‚</p>
         <p class="warning-text">è¿‡å¤§çš„ç¼ºå£å¯èƒ½å¯¼è‡´ï¼š</p>
         <ul>
           <li>è‚Œè‚‰æµå¤±</li>
           <li>åŸºç¡€ä»£è°¢ä¸‹é™</li>
           <li>è¥å…»ä¸è‰¯</li>
         </ul>
       </div>
       <div class="modal-footer">
         <button class="btn-modal-secondary" @click="closeWarning">
           ä»ä½¿ç”¨ {{ formData.deficit_target }} kcal/å¤©
         </button>
         <button class="btn-modal-primary" @click="useRecommendedDeficit">
           ä½¿ç”¨å®‰å…¨å€¼ -500 kcal/å¤©
         </button>
       </div>
     </div>
   </div>
   ```

   ```typescript
   function closeWarning() {
     showWarning.value = false
   }
   function useRecommendedDeficit() {
     formData.value.deficit_target = -500
     showWarning.value = false
   }
   ```

   æ–°å¢ CSSï¼š
   ```css
   .modal-overlay {
     position: fixed;
     top: 0; left: 0; right: 0; bottom: 0;
     background: rgba(0, 0, 0, 0.5);
     display: flex;
     align-items: center;
     justify-content: center;
     z-index: 1000;
   }
   .modal-content {
     background: white;
     border-radius: 20px;
     max-width: 400px;
     animation: modalSlideIn 0.3s ease;
   }
   @keyframes modalSlideIn {
     from { opacity: 0; transform: translateY(-20px); }
     to { opacity: 1; transform: translateY(0); }
   }
   ```

================================================================================
è®¾è®¡æ–‡æ¡£
================================================================================

æœ¬æ¬¡æ›´æ–°åŒæ—¶ç”Ÿæˆäº†å®Œæ•´çš„è®¾è®¡æ–‡æ¡£ï¼š

1. DESIGN_PROPOSALS.md - è®¾è®¡é£æ ¼ææ¡ˆ
   - æ–¹æ¡ˆä¸€ï¼šæ¸…æ–°å¥åº·é£ï¼ˆæ¨èï¼‰
   - æ–¹æ¡ˆäºŒï¼šç°ä»£ç§‘æŠ€é£
   - æ–¹æ¡ˆä¸‰ï¼šæ¸©æš–æ²»æ„ˆé£
   - å®Œæ•´çš„è‰²å½©ã€å­—ä½“ã€åœ†è§’ã€ç»„ä»¶è§„èŒƒ
   - å¯è®¿é—®æ€§æŒ‡å—

2. VISUAL_PROTOTYPES.md - å¯è§†åŒ–åŸå‹
   - æ‰€æœ‰é¡µé¢çš„ ASCII åŸå‹å›¾
   - é¦–é¡µã€æ‹ç…§è®°å½•é¡µã€è¿›åº¦è¿½è¸ªé¡µã€ç›®æ ‡è®¾ç½®é¡µ
   - å„é¡µé¢å¤šç§çŠ¶æ€å±•ç¤º
   - é¢œè‰²é€ŸæŸ¥è¡¨å’Œç»„ä»¶çŠ¶æ€ç¤ºæ„

è®¾è®¡æ ¸å¿ƒç†å¿µï¼šæç®€ä¸»ä¹‰ + é£Ÿç‰©æ¸©åº¦æ„Ÿ
æ¨èé‡‡ç”¨ã€Œæ¸…æ–°å¥åº·é£ã€æ–¹æ¡ˆï¼Œè“ç»¿è‰²ç³»ä¼ è¾¾å¥åº·ã€ç§‘å­¦ã€å¯ä¿¡æ„Ÿã€‚

================================================================================
